<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Heran√ßa Gen√©tica - Casos Cl√≠nicos</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #eef2ff, #dbeafe);
    color: #1e293b;
    margin: 0;
    padding: 0;
  }
  .container {
    max-width: 600px;
    margin: auto;
    padding: 16px;
  }
  h1 {
    text-align: center;
    color: #1e3a8a;
  }
  #scanner, #case-area {
    margin-top: 20px;
  }
  #reader {
    width: 100%;
    height: auto;
  }
  #chat {
    max-height: 400px;
    overflow-y: auto;
    padding: 10px;
    border: 1px solid #e5e7eb;
    border-radius: 10px;
    margin-bottom: 10px;
    background-color: #f9fafb;
  }
  .message {
    margin: 8px 0;
    padding: 10px 14px;
    border-radius: 16px;
    max-width: 80%;
    line-height: 1.4;
  }
  .npc {
    background-color: #e0e7ff;
    align-self: flex-start;
  }
  .user {
    background-color: #bfdbfe;
    align-self: flex-end;
    margin-left: auto;
  }
  #options {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  button {
    padding: 12px;
    border: none;
    border-radius: 10px;
    background-color: #3b82f6;
    color: white;
    font-weight: 500;
    cursor: pointer;
    transition: 0.2s;
  }
  button:hover {
    background-color: #2563eb;
  }
  .typing {
    font-style: italic;
    color: #6b7280;
  }
  @media (max-width: 600px) {
    h1 { font-size: 1.4em; }
    button { font-size: 0.9em; }
  }
</style>
</head>
<body>
<div class="container">
  <h1>üß¨ Heran√ßa Gen√©tica - Casos Cl√≠nicos</h1>

  <div id="scanner">
    <p>Escaneie o QR Code do caso cl√≠nico para come√ßar:</p>
    <div id="reader"></div>
  </div>

  <div id="case-area" style="display:none;">
    <p id="case-desc"></p>
    <div id="chat"></div>
    <div id="options"></div>
  </div>
</div>

<!-- Biblioteca QR Code -->
<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

<script>
/* ===========================
   Casos Cl√≠nicos (Base Local)
   =========================== */
const cases = {
  "case1": {
    id: "case1",
    title: "Caso Cl√≠nico 1 - Distrofia Muscular",
    description: "Paciente de 12 anos com fraqueza muscular progressiva. H√° suspeita de condi√ß√£o gen√©tica. Descubra o tipo de heran√ßa.",
    dialogue: [
      { 
        questions: ["Algum dos pais √© afetado?", "Algum dos pais √© portador?"],
        answers: [
          "Nenhum dos pais apresenta sintomas vis√≠veis.",
          "A m√£e √© portadora confirmada da muta√ß√£o, mas n√£o apresenta sintomas cl√≠nicos."
        ]
      },
      { 
        questions: ["H√° outros casos na fam√≠lia?", "Os irm√£os s√£o afetados?"],
        answers: [
          "Sim, h√° dois tios maternos que tiveram sintomas semelhantes.",
          "O irm√£o mais velho tamb√©m apresenta os mesmos sintomas."
        ]
      },
      { 
        questions: ["H√° diferen√ßa entre meninos e meninas?", "As meninas tamb√©m s√£o afetadas?"],
        answers: [
          "A condi√ß√£o √© observada apenas nos meninos da fam√≠lia.",
          "As meninas geralmente n√£o apresentam sintomas, mas podem ser portadoras."
        ]
      },
      { 
        questions: ["H√° casos em gera√ß√µes anteriores?", "O pai ou o av√¥ paterno tem sintomas?"],
        answers: [
          "O av√¥ materno teve sintomas semelhantes na juventude.",
          "No lado paterno da fam√≠lia, n√£o h√° registros da condi√ß√£o."
        ]
      }
    ]
  }
};

/* ===========================
   Sistema de Chat
   =========================== */
const chatBox = document.createElement('div');
const optionsBox = document.createElement('div');
let step = 0;
let maxSteps = 4;
let currentCase = null;

function appendMessage(sender, text) {
  const msg = document.createElement('div');
  msg.classList.add('message', sender);
  msg.textContent = text;
  document.getElementById('chat').appendChild(msg);
  document.getElementById('chat').scrollTop = chatBox.scrollHeight;
}

function typeWriter(text, callback) {
  const typing = document.createElement('div');
  typing.classList.add('typing');
  typing.textContent = "NPC est√° digitando...";
  document.getElementById('chat').appendChild(typing);
  setTimeout(() => {
    typing.remove();
    appendMessage('npc', text);
    if (callback) callback();
  }, 1000 + Math.random() * 800);
}

function nextStep() {
  const options = document.getElementById('options');
  options.innerHTML = '';
  if (step >= maxSteps) {
    appendMessage('npc', "Essas foram todas as perguntas! Agora, com base nas respostas, qual tipo de heran√ßa voc√™ acha que √©?");
    appendMessage('npc', "üí° Dica: Apenas meninos afetados e m√£es portadoras... isso sugere heran√ßa **ligada ao X recessiva**.");
    return;
  }
  const qData = currentCase.dialogue[step];
  const btn1 = document.createElement('button');
  const btn2 = document.createElement('button');
  btn1.textContent = qData.questions[0];
  btn2.textContent = qData.questions[1];
  btn1.onclick = () => chooseOption(0);
  btn2.onclick = () => chooseOption(1);
  options.appendChild(btn1);
  options.appendChild(btn2);
}

function chooseOption(i) {
  const qData = currentCase.dialogue[step];
  appendMessage('user', qData.questions[i]);
  typeWriter(qData.answers[i], () => {
    step++;
    nextStep();
  });
}

function startCase(caseId) {
  currentCase = cases[caseId];
  if (!currentCase) {
    alert("Caso n√£o encontrado!");
    return;
  }
  document.getElementById('scanner').style.display = 'none';
  document.getElementById('case-area').style.display = 'block';
  document.getElementById('case-desc').innerHTML = `<strong>${currentCase.title}</strong><br>${currentCase.description}`;
  document.getElementById('chat').innerHTML = '';
  document.getElementById('options').innerHTML = '';
  step = 0;
  typeWriter("Ol√°! üëã Eu sou o NPC gen√©tico. Voc√™ pode fazer at√© 4 perguntas para descobrir o tipo de heran√ßa deste caso.", () => {
    nextStep();
  });
}

/* ===========================
   Leitor de QR Code
   =========================== */
function initQRScanner() {
  const html5QrCode = new Html5Qrcode("reader");
  const qrConfig = { fps: 10, qrbox: { width: 250, height: 250 } };

  html5QrCode.start(
    { facingMode: "environment" },
    qrConfig,
    (decodedText) => {
      html5QrCode.stop().then(() => {
        startCase(decodedText.trim());
      });
    },
    (errorMessage) => {}
  ).catch(err => {
    document.getElementById('reader').innerHTML = "<p style='color:red;'>Erro ao acessar c√¢mera. Verifique as permiss√µes.</p>";
  });
}

window.onload = initQRScanner;
</script>
</body>
</html>
