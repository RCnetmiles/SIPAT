<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>A Saga do Mosquito</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        .mosquito {
            touch-action: none;
            user-select: none;
            z-index: 50;
        }
        
        .mosquito-copy {
            position: absolute;
            width: 3rem;
            height: 3rem;
            z-index: 30;
            pointer-events: none;
        }
        
        .landing-area {
            min-width: 120px;
            margin: 0 10px;
            flex-grow: 1;
            position: relative;
            overflow: visible;
            z-index: 10;
        }
        
        .landing-container {
            justify-content: space-between;
            padding: 0 10px;
            margin-top: 30px;
            display: flex;
            flex-wrap: wrap;
            position: relative;
            z-index: 10;
        }
        
        .alert {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s;
            width: 90%;
            max-width: 300px;
            text-align: center;
        }
        
        .success {
            background-color: #10B981;
        }
        
        .danger {
            background-color: #EF4444;
        }

        .game-container {
            position: relative;
            width: 100%;
            max-width: 100%;
            height: 50vh;
            background-color: #e5e7eb;
            border-radius: 0.5rem;
            margin-bottom: 2rem;
            overflow: visible;
            z-index: 20;
            touch-action: pan-y;
        }

        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .hidden {
            display: none;
        }
        
        /* Melhorias para mobile */
        @media (max-width: 768px) {
            .landing-container {
                flex-direction: column;
                align-items: center;
            }
            
            .landing-area {
                width: 90%;
                margin-bottom: 15px;
                min-width: unset;
            }
            
            .game-container {
                height: 40vh;
            }
            
            header h1 {
                font-size: 1.8rem;
            }
            
            header p {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-4">
    <div id="successAlert" class="alert success">✅ Foco eliminado! Área limpa!</div>
    <div id="dangerAlert" class="alert danger">❌ Mosquito se proliferou! Cuidado!</div>

    <!-- Tela de Game Over -->
    <div id="gameOver" class="game-over hidden">
        <h2 id="gameOverMessage" class="text-3xl md:text-4xl font-bold mb-4"></h2>
        <button id="restartBtn" class="px-6 py-3 bg-green-500 text-white rounded-lg text-xl mt-4">
            Jogar Novamente
        </button>
    </div>

    <header class="w-full max-w-4xl mb-4 md:mb-8">
        <h1 class="text-2xl md:text-4xl font-bold text-center text-gray-800">A Saga do Mosquito</h1>
        <p class="text-center text-gray-600 mt-2 text-sm md:text-base">Arraste o mosquito para os pontos de pouso!</p>
        <div class="text-center mt-2 md:mt-4">
            <span class="text-base md:text-lg font-semibold">Mosquitos no spawn: <span id="mosquitoCount">0</span>/6</span>
        </div>
    </header>

    <!-- Container do jogo (área de spawn) -->
    <div class="game-container" id="gameContainer">
        <img id="mosquito" src="https://png.pngtree.com/png-clipart/20240418/original/pngtree-aedes-aegypti-mosquito-png-image_14878795.png" alt="Mosquito" 
             class="mosquito absolute w-12 h-12 md:w-16 md:h-16 cursor-grab active:cursor-grabbing"
             draggable="false"
             style="left: 50%; top: 50%; transform: translate(-50%, -50%);">
    </div>

    <!-- Áreas de pouso -->
    <div class="landing-container w-full max-w-4xl">
        <div class="landing-area bg-green-100 h-24 md:h-32 rounded-lg flex items-center justify-center mb-4" data-type="success">
            <span class="text-gray-700 text-sm md:text-base">Ponto Seguro 1</span>
        </div>
        <div class="landing-area bg-red-100 h-24 md:h-32 rounded-lg flex items-center justify-center mb-4" data-type="danger">
            <span class="text-gray-700 text-sm md:text-base">Ponto de Risco 1</span>
        </div>
        <div class="landing-area bg-green-100 h-24 md:h-32 rounded-lg flex items-center justify-center mb-4" data-type="success">
            <span class="text-gray-700 text-sm md:text-base">Ponto Seguro 2</span>
        </div>
        <div class="landing-area bg-red-100 h-24 md:h-32 rounded-lg flex items-center justify-center mb-4" data-type="danger">
            <span class="text-gray-700 text-sm md:text-base">Ponto de Risco 2</span>
        </div>
        <div class="landing-area bg-green-100 h-24 md:h-32 rounded-lg flex items-center justify-center mb-4" data-type="success">
            <span class="text-gray-700 text-sm md:text-base">Ponto Seguro 3</span>
        </div>
        <div class="landing-area bg-red-100 h-24 md:h-32 rounded-lg flex items-center justify-center mb-4" data-type="danger">
            <span class="text-gray-700 text-sm md:text-base">Ponto de Risco 3</span>
        </div>
    </div>

    <div class="mt-6 md:mt-8 text-center">
        <button id="resetBtn" class="px-6 py-2 bg-red-500 text-white rounded-lg shadow hover:bg-red-600 transition text-sm md:text-base">
            Reiniciar Mosquito
        </button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mosquito = document.getElementById('mosquito');
            const resetBtn = document.getElementById('resetBtn');
            const restartBtn = document.getElementById('restartBtn');
            const successAlert = document.getElementById('successAlert');
            const dangerAlert = document.getElementById('dangerAlert');
            const landingAreas = document.querySelectorAll('.landing-area');
            const gameContainer = document.getElementById('gameContainer');
            const mosquitoCount = document.getElementById('mosquitoCount');
            const gameOver = document.getElementById('gameOver');
            const gameOverMessage = document.getElementById('gameOverMessage');
            
            let isDragging = false;
            let startX, startY, initialX = 0, initialY = 0;
            let mosquitoCopies = [];
            let scrollInterval = null;
            let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            // Posição inicial do mosquito
            const containerRect = gameContainer.getBoundingClientRect();
            const initialLeft = containerRect.width / 2 - mosquito.offsetWidth / 2;
            const initialTop = containerRect.height / 2 - mosquito.offsetHeight / 2;
            
            // Mouse/Touch down
            function startDrag(e) {
                isDragging = true;
                
                // Prevenir comportamento padrão para evitar scroll indesejado
                e.preventDefault();
                
                if (e.type === 'mousedown') {
                    startX = e.clientX;
                    startY = e.clientY;
                } else if (e.type === 'touchstart') {
                    startX = e.touches[0].clientX;
                    startY = e.touches[0].clientY;
                }
                
                // Pega a posição atual do mosquito
                const currentLeft = parseInt(mosquito.style.left) || initialLeft;
                const currentTop = parseInt(mosquito.style.top) || initialTop;
                
                initialX = currentLeft;
                initialY = currentTop;
                
                mosquito.style.transition = 'none';
                mosquito.classList.add('shadow-xl');
                mosquito.style.zIndex = '100';
                
                // Inicia verificação de scroll automático
                startAutoScroll();
            }
            
            // Mouse/Touch move
            function drag(e) {
                if (!isDragging) return;
                
                let currentX, currentY;
                
                if (e.type === 'mousemove') {
                    currentX = e.clientX;
                    currentY = e.clientY;
                } else if (e.type === 'touchmove') {
                    currentX = e.touches[0].clientX;
                    currentY = e.touches[0].clientY;
                    e.preventDefault(); // Prevenir scroll durante o arrasto
                }
                
                const dx = currentX - startX;
                const dy = currentY - startY;
                
                // Calcula nova posição
                const newX = initialX + dx;
                const newY = initialY + dy;
                
                // Atualiza a posição
                mosquito.style.left = `${newX}px`;
                mosquito.style.top = `${newY}px`;
            }
            
            // Scroll automático quando o mosquito chega perto das bordas
            function startAutoScroll() {
                if (scrollInterval) clearInterval(scrollInterval);
                
                scrollInterval = setInterval(() => {
                    if (!isDragging) {
                        clearInterval(scrollInterval);
                        return;
                    }
                    
                    const mosquitoRect = mosquito.getBoundingClientRect();
                    const scrollSpeed = isMobile ? 10 : 15; // Velocidade menor no mobile
                    
                    // Verifica se está perto da borda inferior
                    if (mosquitoRect.bottom > window.innerHeight - 50) {
                        window.scrollBy(0, scrollSpeed);
                    }
                    // Verifica se está perto da borda superior
                    else if (mosquitoRect.top < 100) {
                        window.scrollBy(0, -scrollSpeed);
                    }
                }, 50);
            }
            
            // Mouse/Touch up - verifica se soltou em uma área
            function endDrag(e) {
                if (!isDragging) return;
                isDragging = false;
                
                if (scrollInterval) {
                    clearInterval(scrollInterval);
                    scrollInterval = null;
                }
                
                mosquito.style.transition = 'left 0.3s, top 0.3s';
                mosquito.classList.remove('shadow-xl');
                mosquito.style.zIndex = '50';
                
                // Verifica se soltou em alguma área
                const mosquitoRect = mosquito.getBoundingClientRect();
                let droppedOnArea = false;
                
                landingAreas.forEach(area => {
                    const areaRect = area.getBoundingClientRect();
                    
                    // Verifica colisão
                    if (
                        mosquitoRect.left < areaRect.right &&
                        mosquitoRect.right > areaRect.left &&
                        mosquitoRect.top < areaRect.bottom &&
                        mosquitoRect.bottom > areaRect.top
                    ) {
                        droppedOnArea = true;
                        
                        if (area.dataset.type === 'success') {
                            handleSafeArea();
                        } else {
                            handleDangerArea();
                        }
                    }
                });
                
                // O mosquito permanece na posição onde foi solto, não resetamos
            }
            
            // Lógica para área segura
            function handleSafeArea() {
                showAlert(successAlert);
                
                // Remove uma cópia do mosquito se existir
                if (mosquitoCopies.length > 0) {
                    const lastCopy = mosquitoCopies.pop();
                    lastCopy.remove();
                    updateMosquitoCount();
                } 
                // Se não há cópias, remove o mosquito principal e termina o jogo
                else if (mosquitoCopies.length === 0) {
                    mosquito.style.display = 'none';
                    endGame("🎉 Parabéns! Você eliminou todos os focos do mosquito!");
                }
            }
            
            // Lógica para área de risco
            function handleDangerArea() {
                showAlert(dangerAlert);
                
                // Cria uma nova cópia do mosquito na área de spawn
                createMosquitoCopy();
                
                // Verifica se o jogador perdeu (6 cópias)
                if (mosquitoCopies.length >= 6) {
                    endGame("💀 Game Over! O mosquito se proliferou demais!");
                }
            }
            
            // Cria uma cópia do mosquito na área de spawn
            function createMosquitoCopy() {
                const copy = document.createElement('img');
                copy.src = mosquito.src;
                copy.className = 'mosquito-copy';
                copy.alt = 'Mosquito Copy';
                
                // Encontra uma posição aleatória que não sobreponha outros mosquitos
                const position = findNonOverlappingPosition();
                copy.style.left = `${position.x}px`;
                copy.style.top = `${position.y}px`;
                
                gameContainer.appendChild(copy);
                mosquitoCopies.push(copy);
                updateMosquitoCount();
            }
            
            // Encontra uma posição que não sobreponha outros mosquitos
            function findNonOverlappingPosition() {
                const containerRect = gameContainer.getBoundingClientRect();
                const mosquitoSize = isMobile ? 40 : 48; // Tamanho menor no mobile
                const maxAttempts = 50;
                
                for (let attempt = 0; attempt < maxAttempts; attempt++) {
                    const x = Math.random() * (containerRect.width - mosquitoSize);
                    const y = Math.random() * (containerRect.height - mosquitoSize);
                    
                    const newRect = {
                        left: x,
                        right: x + mosquitoSize,
                        top: y,
                        bottom: y + mosquitoSize
                    };
                    
                    let overlaps = false;
                    
                    // Verifica sobreposição com cópias existentes
                    for (const copy of mosquitoCopies) {
                        const copyRect = {
                            left: copy.offsetLeft,
                            right: copy.offsetLeft + mosquitoSize,
                            top: copy.offsetTop,
                            bottom: copy.offsetTop + mosquitoSize
                        };
                        
                        if (
                            newRect.left < copyRect.right &&
                            newRect.right > copyRect.left &&
                            newRect.top < copyRect.bottom &&
                            newRect.bottom > copyRect.top
                        ) {
                            overlaps = true;
                            break;
                        }
                    }
                    
                    // Verifica sobreposição com o mosquito principal
                    if (!overlaps) {
                        const mosquitoRect = {
                            left: mosquito.offsetLeft,
                            right: mosquito.offsetLeft + mosquito.offsetWidth,
                            top: mosquito.offsetTop,
                            bottom: mosquito.offsetTop + mosquito.offsetHeight
                        };
                        
                        if (
                            newRect.left < mosquitoRect.right &&
                            newRect.right > mosquitoRect.left &&
                            newRect.top < mosquitoRect.bottom &&
                            newRect.bottom > mosquitoRect.top
                        ) {
                            overlaps = true;
                        }
                    }
                    
                    if (!overlaps) {
                        return { x, y };
                    }
                }
                
                // Se não encontrou posição sem sobreposição após várias tentativas,
                // retorna uma posição aleatória mesmo com sobreposição
                return {
                    x: Math.random() * (containerRect.width - mosquitoSize),
                    y: Math.random() * (containerRect.height - mosquitoSize)
                };
            }
            
            // Atualiza o contador de mosquitos
            function updateMosquitoCount() {
                mosquitoCount.textContent = mosquitoCopies.length;
            }
            
            // Finaliza o jogo
            function endGame(message) {
                gameOverMessage.textContent = message;
                gameOver.classList.remove('hidden');
            }
            
            // Reinicia o jogo
            function restartGame() {
                // Remove todas as cópias
                mosquitoCopies.forEach(copy => copy.remove());
                mosquitoCopies = [];
                
                // Reseta o mosquito principal
                mosquito.style.display = 'block';
                mosquito.style.left = '50%';
                mosquito.style.top = '50%';
                mosquito.style.transform = 'translate(-50%, -50%)';
                
                // Atualiza contador
                updateMosquitoCount();
                
                // Esconde tela de game over
                gameOver.classList.add('hidden');
                
                // Scroll para o topo
                window.scrollTo(0, 0);
            }
            
            function showAlert(alertElement) {
                alertElement.style.opacity = '1';
                setTimeout(() => {
                    alertElement.style.opacity = '0';
                }, 2000);
            }
            
            function resetMosquitoPosition() {
                mosquito.style.left = '50%';
                mosquito.style.top = '50%';
                mosquito.style.transform = 'translate(-50%, -50%)';
            }
            
            // Event listeners para mouse
            mosquito.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', endDrag);
            
            // Event listeners para touch - melhorados para mobile
            mosquito.addEventListener('touchstart', startDrag, { passive: false });
            document.addEventListener('touchmove', drag, { passive: false });
            document.addEventListener('touchend', endDrag);
            
            // Prevenir comportamento padrão de gestos para melhor experiência mobile
            document.addEventListener('gesturestart', function(e) {
                e.preventDefault();
            });
            
            document.addEventListener('gesturechange', function(e) {
                e.preventDefault();
            });
            
            document.addEventListener('gestureend', function(e) {
                e.preventDefault();
            });
            
            // Botão reset
            resetBtn.addEventListener('click', resetMosquitoPosition);
            
            // Botão restart
            restartBtn.addEventListener('click', restartGame);
            
            // Garantir que a página carregue no topo no mobile
            window.addEventListener('load', function() {
                setTimeout(function() {
                    window.scrollTo(0, 0);
                }, 0);
            });
        });
    </script>
    <script>feather.replace();</script>
</body>
</html>
